#!/usr/bin/env bash
# Auto-create and activate project virtualenv (.venv) and load .env if present.
#
# This file is intended for use with direnv: https://direnv.net/
#
# Behavior:
# - If .venv does not exist, attempt to create it with `python -m venv .venv`.
# - Activate .venv for the shell session.
# - If a .env file exists, source it so KEY=VALUE pairs become available.

if [ -d ".venv" ]; then
  # shellcheck source=/dev/null
  source .venv/bin/activate
else
  # Prefer python3, fallback to python
  PY_BIN="$(command -v python3.11 || command -v python3 || command -v python || true)"
  if [ -z "$PY_BIN" ]; then
    echo "Warning: python not found in PATH; please install Python 3 and rerun." >&2
  else
    # Create .venv with upgraded dependencies (ensure pip present)
    "$PY_BIN" -m venv --upgrade-deps .venv || "$PY_BIN" -m venv .venv || true
    # shellcheck source=/dev/null
    source .venv/bin/activate || true
  fi
fi

if [ -f ".env" ]; then
  # source .env to export KEY=VALUE style entries
  # shellcheck source=/dev/null
  source .env
fi


